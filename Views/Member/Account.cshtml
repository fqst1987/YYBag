@model YYBagProgram.Models.Members;
@{
    ViewData["titlemsg"] = "會員資料";
}
<head>
    <title>YYBag-@ViewData["titlemsg"]</title>
    <link rel="stylesheet" href="~/css/member.min.css" />
    <link rel="stylesheet" href="~/css/alert.min.css" />
</head>
<div class="membercenter_main">
    <span class="membercenter_span_title">我的會員中心</span>
    <div class="membercenter_client_main">
        <div class="membercenter_client_list">
            <div class="memberlogo">
                <img src="https://fakeimg.pl/50x50/">
                <span class="member_span_3">@Model.strMemberName</span>
            </div>
            <hr />
            <div class="memberlistblock_h align_item_center">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#5B7493" class="bi bi-person-plus" viewBox="0 0 16 16">
                    <path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H1s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C9.516 10.68 8.289 10 6 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z" />
                    <path fill-rule="evenodd" d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5" />
                </svg>
                <a class="a_membercenter_h" href="@Url.Action("MemberCenter","Member")" id="myinfo">個人資料</a>
            </div>
            <div class="memberlistblock">
                <a class="a_membercenter" href="#" id="address">收件地址</a>
            </div>
            <div class="memberlistblock">
                <a class="a_membercenter" href="#" id="changepassword">更改密碼</a>
            </div>
            <div class="memberlistblock_h align_item_center">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#5B7493" class="bi bi-bag" viewBox="0 0 16 16">
                    <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z" />
                </svg>
                <a class="a_membercenter_h" href="@Url.Action("MemberCart", "Member")" id="shoplist">購物車</a>
            </div>
            <div class="memberlistblock_h align_item_center">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#5B7493" class="bi bi-card-checklist" viewBox="0 0 16 16">
                    <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2z" />
                    <path d="M7 5.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m-1.496-.854a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 1 1 .708-.708l.146.147 1.146-1.147a.5.5 0 0 1 .708 0M7 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m-1.496-.854a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0l-.5-.5a.5.5 0 0 1 .708-.708l.146.147 1.146-1.147a.5.5 0 0 1 .708 0" />
                </svg>
                <a class="a_membercenter_h" href="#" id="shoplist">購買清單</a>
            </div>
            <a class="a_membercenter_logout" href="@Url.Action("Logout", "Member")">登出</a>
        </div>
        <div class="membercenter_client_edit flex_direction_column">
            <div class="memberinfo_1 align_item_center">
                <h2>個人資料</h2>
            </div>
            <hr />
            <div class="memberinfo_2 flex_direction_column">
                <div class="membercenter_client_edit_list_block">
                    <label class="member_label">姓名</label>
                    <input class="member_input" value="@Model.strMemberName" readonly>
                </div>
                <div class="membercenter_client_edit_list_block">
                    <label class="member_label">手機</label>
                    <input class="member_input" value="@Model.strMemberPhone" type="number" id="memberphone" />
                </div>
                <div class="membercenter_client_edit_list_block">
                    <label class="member_label">Email</label>
                    <input class="member_input" value="@Model.strMemberEmail" readonly />
                </div>
                <div class="membercenter_client_edit_list_block">
                    <label class="member_label">生日</label>
                    @{
                        string formattedDate = Model.dateBirthday?.ToString("yyyy-MM-dd") ?? string.Empty;
                    }
                    <input type="date" value="@formattedDate" style="width: 160px;" id="memberbirthday">
                </div>
                <div class="membercenter_client_edit_list_block">
                    <label class="member_label"></label>
                    <button class="btn_comfirm" id="updatemember">儲存</button>
                </div>
            </div>
        </div>
    </div>
    <!--alert-->
    <div id="modal_alertSucess" class="modal_alertSucess">
        <div class="modal_alertSucess_content" id="modal_alertSucess_content">
            <img src="https://fakeimg.pl/100x100/" style="padding-top: 30px;">
            <p id="modal_alertSucess_message"></p>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            
            $(window).on('load', function (){
                $('#myinfo').css('color', "#E3BCB5");
            });

            function getToken() {
                var token = '@Html.AntiForgeryToken()'
                token = $(token).val();
                return token;
            };

            //顯示密碼
            $('#showPasswordCheckbox').change(function () {
                var passwordField = $('#password');
                var fieldType = passwordField.attr('type');
                if (fieldType === 'password') {
                    passwordField.attr('type', 'text');
                } else {
                    passwordField.attr('type', 'password');
                }
            });

            //彈出
            $(document).ready(function () {
                if ($(window).width() <= 768) {
                    $('.memberlistblock_h').click(function () {

                        const parentBlock = $(this).parent();

                        const listBlock = parentBlock.find('.memberlistblock');

                        listBlock.slideToggle('600');
                    });
                }
            });
            //alert
            function openModal(message) {

                var modal = document.getElementById("modal_alertSucess");
                var modalMessage = document.getElementById("modal_alertSucess_message");
                modalMessage.innerText = message;
                modal.style.display = "block";

                setTimeout(function () {
                    modal.style.display = "none";
                }, 3000);
            }

            //儲存
            $('#updatemember').click(function () {
                var memberId = "@Model.strMemberId";
                var memberPassword = "@Model.strMemberPassWord";
                var memberName = "@Model.strMemberName";
                var memberPhone = $('#memberphone').val() || null;
                var memberEmail = "@Model.strMemberEmail";
                var memberBirthday = $('#memberbirthday').val() || null;
                updatemember(memberId, memberPassword, memberName, memberPhone, memberEmail, memberBirthday, function (response) {
                    if (response) {
                        openModal("已修改個人資料!");
                    }
                    else {
                        openModal("沒有更改個人資料!");
                    }
                });
            })

            // 更改個人資料
            function updatemember(memberId, memberPassword, memberName, memberPhone, memberEmail, memberBirthday, callback) {
                var postData = {
                    strMemberId: memberId,
                    strMemberPassWord: memberPassword,
                    strMemberName: memberName,
                    strMemberPhone: memberPhone,
                    strMemberEmail: memberEmail,
                    dateBirthday: memberBirthday,
                    isReview: true,
                    isGoogleAccount: false
                };
                console.log(JSON.stringify(postData));
                $.ajax({
                    url: '/Member/UpdateMember',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(postData),
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("RequestVerificationToken", getToken());
                    },
                    success: function (response) {
                        if (response.result) {
                            callback(true);
                        }
                        else {
                            callback(false);
                        }
                    },
                    error: function (errormessage) {
                        callback(false);
                    }
                });
            }
        });
    </script>
}
